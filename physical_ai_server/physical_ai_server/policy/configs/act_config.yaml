# ACT Policy Configuration  
# Based on LeRobot's configuration_act.py

policy_name: "act"

# Vision Backbone Configuration
vision_backbone:
  name: "resnet18"  # Options: resnet18, resnet34, resnet50, efficientnet_b0, efficientnet_b3
  pretrained: true
  replace_final_stride_with_dilation: false
  
  # ResNet configurations
  resnet18:
    n_channels: 3
    pretrained: true
    replace_final_stride_with_dilation: false
    
  resnet34:
    n_channels: 3
    pretrained: true
    replace_final_stride_with_dilation: false
    
  resnet50:
    n_channels: 3
    pretrained: true
    replace_final_stride_with_dilation: false
    
  # EfficientNet configurations
  efficientnet_b0:
    pretrained: true
    n_channels: 3
    
  efficientnet_b3:
    pretrained: true
    n_channels: 3

# Spatial Softmax Configuration
spatial_softmax:
  enabled: false
  num_kp: null
  learnable_temperature: false
  temperature: 1.0
  noise_std: 0.0

# Transformer Architecture Configuration
transformer:
  # Encoder settings
  encoder:
    num_layers: 4
    num_heads: 8
    feedforward_dim: 2048
    dropout: 0.1
    activation: "relu"  # Options: relu, gelu, silu
    
  # Decoder settings  
  decoder:
    num_layers: 7
    num_heads: 8
    feedforward_dim: 2048
    dropout: 0.1
    activation: "relu"
    
  # Model dimensions
  d_model: 256  # Hidden dimension
  d_kv: 64      # Key-value dimension
  
  # Positional encoding
  positional_encoding:
    max_len: 1000
    dropout: 0.1

# VAE (Variational AutoEncoder) Configuration
vae:
  enabled: true
  
  # Latent space configuration
  latent_dim: 256
  kl_weight: 10.0
  
  # Encoder architecture
  encoder:
    hidden_dims: [512, 1024]
    activation: "relu"
    dropout: 0.1
    
  # Decoder architecture
  decoder:
    hidden_dims: [1024, 512]
    activation: "relu"
    dropout: 0.1
    
  # KL divergence settings
  kl_divergence:
    beta: 1.0
    beta_schedule: "constant"  # Options: constant, linear, cosine
    beta_start: 0.0
    beta_end: 1.0
    warmup_steps: 1000

# Action Chunking Configuration
action_chunking:
  enabled: true
  chunk_size: 100  # Number of future actions to predict
  execution_horizon: 8  # Number of actions to execute per step

# Query and Key Configuration
query_frequency: 1  # Frequency of queries relative to actions

# Crop Configuration for Camera Images
crop:
  enabled: true
  top: 0
  left: 0
  height: 480
  width: 640

# Training Configuration
training:
  # Optimizer settings
  optimizer:
    name: "AdamW"
    lr: 1.0e-5
    weight_decay: 1.0e-4
    betas: [0.9, 0.999]
    eps: 1.0e-8
    
  # Learning rate scheduler
  lr_scheduler:
    name: "cosine"
    warmup_steps: 500
    max_steps: 100000
    
  # Training hyperparameters
  batch_size: 8
  num_epochs: 2000
  gradient_clip_val: 10.0
  
  # Validation settings
  val_check_interval: 250
  save_checkpoint: true
  
  # Loss configuration
  loss:
    name: "l1"  # Options: l1, mse, huber
    reduction: "mean"
    
  # VAE loss weight
  vae_loss_weight: 1.0

# Evaluation Configuration
evaluation:
  n_episodes: 50
  max_episode_steps: 400

# Hardware Configuration  
device:
  type: "auto"  # Options: auto, cpu, cuda, mps
  compile: false  # Whether to use torch.compile

# Model Checkpointing
checkpoint:
  save_dir: "./checkpoints/act"
  save_top_k: 3
  monitor: "val_loss"
  mode: "min"

# Logging Configuration
logging:
  wandb:
    enabled: false
    project: "act_policy"
    entity: null
    
  tensorboard:
    enabled: true
    log_dir: "./logs/act"

# Robot-specific data configuration is handled separately
# Data settings (image_keys, delta_timestamps) are loaded from:
# 1. Pretrained model's config.json (when using pretrained models)
# 2. Robot-specific configuration files (for different robot types)
# 3. Runtime user overrides (when needed)

# Environment-specific presets
presets:
  aloha:
    vision_backbone:
      name: "resnet18"
    crop:
      enabled: true
      top: 0
      left: 0
      height: 480
      width: 640
    action_chunking:
      chunk_size: 100
      execution_horizon: 8
    vae:
      enabled: true
      latent_dim: 32
      kl_weight: 10.0
      
  pusht:
    vision_backbone:
      name: "resnet18"
    crop:
      enabled: false
    action_chunking:
      chunk_size: 50
      execution_horizon: 4
    vae:
      enabled: false
      
  xarm:
    vision_backbone:
      name: "resnet18"
    crop:
      enabled: true
      top: 0
      left: 0
      height: 480
      width: 640
    action_chunking:
      chunk_size: 100
      execution_horizon: 8
    vae:
      enabled: true
      latent_dim: 256
      kl_weight: 10.0

# Model Loading Configuration
model_loading:
  pretrained_policy_name_or_path: null  # Path to pretrained ACT model
  revision: "main"
  local_files_only: false
  trust_remote_code: false
  
  # Model format
  save_format: "safetensors"  # Options: safetensors, pytorch
